---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

// Get all essays, sorted by publish date (newest first)
const allEssays = await getCollection('essays');
console.log('Total essays found:', allEssays.length);
console.log('Essays:', allEssays);

const essays = allEssays
  .filter(essay => !essay.data.draft)
  .sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf());

console.log('Filtered essays:', essays.length);
---

<BaseLayout title="Essays" description="Longform writing and extended thoughts">
  <main class="container">
    <h1>Essays</h1>
    <p>Longer reads, extended thoughts, and deeper explorations.</p>
    
    <div class="essays-list">
      {essays.map((essay) => (
        <article class="essay-preview">
          <h2>
            <a href={`/essays/${essay.slug}`}>
              {essay.data.title}
            </a>
          </h2>
          <time datetime={essay.data.publishDate.toISOString()}>
{essay.data.publishDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
</time>
          <p>{essay.data.description}</p>
        </article>
      ))}
    </div>
  </main>
</BaseLayout>

<style>
  .essays-list {
    margin-top: var(--space-xl);
  }

  .essay-preview {
    margin-bottom: var(--space-2xl);
    padding-bottom: var(--space-lg);
    border-bottom: 1px solid var(--border-color);
  }

  .essay-preview:last-child {
    border-bottom: none;
  }

  .essay-preview h2 {
    margin-bottom: var(--space-xs);
  }

  .essay-preview h2::before {
    content: none; /* Remove the red dot for these headings */
  }

  .essay-preview h2 a {
    border-bottom: none;
    color: var(--text-primary);
  }

  .essay-preview h2 a:hover {
    color: var(--accent-active);
  }

  .essay-preview time {
    display: block;
    font-family: var(--font-mono);
    font-size: var(--text-xs);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--text-secondary);
    margin-bottom: var(--space-sm);
  }
</style>